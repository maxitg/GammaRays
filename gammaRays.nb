(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     55162,       1397]
NotebookOptionsPosition[     53017,       1320]
NotebookOutlinePosition[     53392,       1337]
CellTagsIndexPosition[     53349,       1334]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Spectral Lags in Very High Energy Emission of GRBs\
\>", "Title",
 CellChangeTimes->{{3.589934697031559*^9, 3.5899347180121403`*^9}, {
  3.592131457104278*^9, 3.592131457862741*^9}}],

Cell[CellGroupData[{

Cell["Model", "Section",
 CellChangeTimes->{{3.5899347262060547`*^9, 3.589934726570508*^9}}],

Cell[CellGroupData[{

Cell["Parameters", "Subsection",
 CellChangeTimes->{{3.592131230779949*^9, 3.592131235512723*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"universe", "=", 
   RowBox[{"{", 
    RowBox[{"Hobs_", ",", "\[CapitalOmega]m_"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.59218334620009*^9, 3.592183353694758*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"burst", "=", 
   RowBox[{"{", 
    RowBox[{
    "\[Gamma]_", ",", "\[Eta]0_", ",", "r0_", ",", "n_", ",", "\[Omega]0_", 
     ",", "\[Theta]0_", ",", "k_", ",", "\[Alpha]_"}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.592183357425045*^9, 3.592183376861951*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"observer", "=", 
   RowBox[{"{", 
    RowBox[{"detectorArea_", ",", "z_", ",", "\[Chi]_"}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.592183378338565*^9, 3.592183385685248*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Relativity", "Subsection",
 CellChangeTimes->{{3.589934837712495*^9, 3.589934839766659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"v", "[", "\[Gamma]_", "]"}], ":=", 
   SqrtBox[
    RowBox[{"1", "-", 
     FractionBox["1", 
      SuperscriptBox["\[Gamma]", "2"]]}]]}], ";"}]], "Input",
 CellChangeTimes->{{3.589934850463387*^9, 3.589934856887154*^9}, {
  3.589935711872209*^9, 3.589935711942636*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cosmology", "Subsection",
 CellChangeTimes->{{3.5899347427477713`*^9, 3.5899347438265457`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"\[CapitalOmega]\[CapitalLambda]", "[", "\[CapitalOmega]m_", "]"}],
    ":=", 
   RowBox[{"1", "-", "\[CapitalOmega]m"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5899349782326403`*^9, 3.589935000464473*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"distance", "[", 
    RowBox[{"universe", ",", "z_"}], "]"}], ":=", 
   RowBox[{
    FractionBox["1", "Hobs"], 
    SqrtBox[
     FractionBox["1", 
      RowBox[{
      "\[CapitalOmega]\[CapitalLambda]", "[", "\[CapitalOmega]m", "]"}]]], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", "z"}], ")"}], 
       RowBox[{"Hypergeometric2F1", "[", 
        RowBox[{
         FractionBox["1", "3"], ",", 
         FractionBox["1", "2"], ",", 
         FractionBox["4", "3"], ",", 
         RowBox[{
          RowBox[{"-", 
           FractionBox["\[CapitalOmega]m", 
            RowBox[{
            "\[CapitalOmega]\[CapitalLambda]", "[", "\[CapitalOmega]m", 
             "]"}]]}], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "+", "z"}], ")"}], "3"]}]}], "]"}]}], "-", 
      RowBox[{"Hypergeometric2F1", "[", 
       RowBox[{
        FractionBox["1", "3"], ",", 
        FractionBox["1", "2"], ",", 
        FractionBox["4", "3"], ",", 
        RowBox[{"-", 
         FractionBox["\[CapitalOmega]m", 
          RowBox[{
          "\[CapitalOmega]\[CapitalLambda]", "[", "\[CapitalOmega]m", 
           "]"}]]}]}], "]"}]}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.589934874380446*^9, 3.589934886285137*^9}, {
   3.5899349693113194`*^9, 3.589934972465304*^9}, {3.589935054177115*^9, 
   3.589935073915997*^9}, 3.589935110006753*^9, {3.589935151236059*^9, 
   3.5899351579007053`*^9}, {3.5921315009060917`*^9, 
   3.5921315207960997`*^9}, {3.592131935717617*^9, 3.592131979444818*^9}, {
   3.592132180555418*^9, 3.5921322199675827`*^9}, {3.5921322609963913`*^9, 
   3.592132261150456*^9}, {3.59218328690254*^9, 3.592183308931731*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"photonSphereArea", "[", 
    RowBox[{"universe_", ",", "z_"}], "]"}], ":=", 
   RowBox[{"4", "\[Pi]", " ", 
    SuperscriptBox[
     RowBox[{"distance", "[", 
      RowBox[{"universe", ",", "z"}], "]"}], "2"]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.589935078530493*^9, 3.589935107355896*^9}, {
   3.589935149961955*^9, 3.589935159393393*^9}, {3.5901499169203653`*^9, 
   3.590149919694723*^9}, {3.592132276651806*^9, 3.59213231399308*^9}, 
   3.5921324338850183`*^9, {3.592132479674905*^9, 3.592132528442235*^9}, {
   3.59213259355765*^9, 3.592132602476036*^9}, 3.592132636578137*^9, {
   3.592132678985426*^9, 3.592132700320488*^9}, {3.5921328703605547`*^9, 
   3.592132878583001*^9}, {3.592134577303495*^9, 3.592134611119673*^9}, {
   3.59213464199679*^9, 3.5921346874769783`*^9}, {3.592134784446424*^9, 
   3.59213481159022*^9}, {3.592135038603594*^9, 3.592135057500444*^9}, {
   3.5921350909931173`*^9, 3.592135194454236*^9}, {3.59218331212173*^9, 
   3.592183333104171*^9}, {3.5921856212934513`*^9, 3.592185621370853*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"burstsSphereArea", "[", 
    RowBox[{"universe_", ",", "z_"}], "]"}], ":=", 
   FractionBox[
    RowBox[{"4", "\[Pi]", " ", 
     SuperscriptBox[
      RowBox[{"distance", "[", 
       RowBox[{"universe", ",", "z"}], "]"}], "2"]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"1", "+", "z"}], ")"}], "2"]]}], ";"}]], "Input",
 CellChangeTimes->{{3.589935120126265*^9, 3.58993516044965*^9}, {
  3.5901499204550657`*^9, 3.590149922334618*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"shellVolumePerRedshift", "[", 
    RowBox[{"universe", ",", "z_"}], "]"}], ":=", 
   RowBox[{
    FractionBox[
     RowBox[{"4", "\[Pi]", " ", 
      SuperscriptBox[
       RowBox[{"distance", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Hobs", ",", "\[CapitalOmega]m"}], "}"}], ",", "z"}], "]"}],
        "2"]}], 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"1", "+", "z"}], ")"}], "3"]], 
    FractionBox["1", 
     RowBox[{"Hobs", 
      SqrtBox[
       RowBox[{
        RowBox[{"\[CapitalOmega]m", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"1", "+", "z"}], ")"}], "3"]}], "+", 
        RowBox[{
        "\[CapitalOmega]\[CapitalLambda]", "[", "\[CapitalOmega]m", 
         "]"}]}]]}]]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.589935175967778*^9, 3.589935290257773*^9}, {
  3.5918412554035797`*^9, 3.591841257099522*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Light curve", "Subsection",
 CellChangeTimes->{{3.589935318987741*^9, 3.5899353237047043`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"i", "[", 
    RowBox[{
    "burst", ",", "z_", ",", "\[Chi]_", ",", "\[Omega]_", ",", "\[Theta]_", 
     ",", "\[Phi]_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Omega]", "\[Equal]", "\[Infinity]"}], ",", 
     "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
     RowBox[{
      FractionBox["1", 
       RowBox[{"2", "k"}]], 
      RowBox[{"\[Omega]", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox["\[Omega]", "\[Omega]0"], ")"}], "\[Alpha]"], 
       RowBox[{"ExpIntegralE", "[", 
        RowBox[{
         RowBox[{
          FractionBox[
           RowBox[{"\[Alpha]", "+", "1"}], 
           RowBox[{"2", "k"}]], "+", "1"}], ",", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["\[Theta]", "\[Theta]0"], ")"}], "2"], 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["\[Omega]", "\[Omega]0"], ")"}], 
           RowBox[{
            RowBox[{"-", "2"}], "k"}]], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"v", "[", "\[Gamma]", "]"}], "\[Gamma]", 
             RowBox[{"(", 
              RowBox[{"1", "+", "z"}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
               FractionBox[
                SuperscriptBox["\[Theta]", "2"], "2"], "+", 
               FractionBox[
                SuperscriptBox["\[Chi]", "2"], "2"], "-", 
               RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}], ")"}], 
           RowBox[{
            RowBox[{"-", "2"}], "k"}]]}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.589935483422423*^9, 3.5899356080330048`*^9}, {
  3.5899356967025957`*^9, 3.589935781512787*^9}, {3.589935933237218*^9, 
  3.589935964665523*^9}, {3.5899360834375477`*^9, 3.58993610489809*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"j", "[", 
    RowBox[{
    "burst", ",", "z_", ",", "\[Chi]_", ",", "\[Tau]_", ",", "\[Theta]_", ",",
      "\[Phi]_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Tau]", "\[Equal]", "\[Infinity]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"r0", 
         RowBox[{"(", 
          RowBox[{
           FractionBox["1", 
            RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
           FractionBox[
            SuperscriptBox["\[Theta]", "2"], "2"], "+", 
           FractionBox[
            SuperscriptBox["\[Chi]", "2"], "2"], "-", 
           RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
            RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
         RowBox[{"(", 
          RowBox[{"1", "+", "z"}], ")"}]}], ")"}], "3"], 
      FractionBox["\[Pi]", 
       RowBox[{"n", " ", 
        RowBox[{"Sin", "[", 
         FractionBox[
          RowBox[{"3", "\[Pi]"}], "n"], "]"}]}]]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      FractionBox[
       SuperscriptBox["\[Tau]", "3"], "3"], 
      RowBox[{"Hypergeometric2F1", "[", 
       RowBox[{"1", ",", 
        FractionBox["3", "n"], ",", 
        FractionBox[
         RowBox[{"n", "+", "3"}], "n"], ",", 
        RowBox[{"-", 
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox["\[Tau]", 
            RowBox[{"r0", 
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
               FractionBox[
                SuperscriptBox["\[Theta]", "2"], "2"], "+", 
               FractionBox[
                SuperscriptBox["\[Chi]", "2"], "2"], "-", 
               RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
             RowBox[{"(", 
              RowBox[{"1", "+", "z"}], ")"}]}]], ")"}], "n"]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5899357885882673`*^9, 3.5899358888161497`*^9}, {
  3.589935971703033*^9, 3.589936024047285*^9}, {3.589936089476865*^9, 
  3.589936099247167*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"p", "[", 
    RowBox[{"universe_", ",", "burst", ",", "observer", ",", 
     RowBox[{"{", 
      RowBox[{"\[Tau]1_", ",", "\[Tau]2_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "burstValues", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"burstValues", "=", 
       RowBox[{"{", 
        RowBox[{
        "\[Gamma]", ",", "\[Eta]0", ",", "r0", ",", "n", ",", "\[Omega]0", 
         ",", "\[Theta]0", ",", "k", ",", "\[Alpha]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       FractionBox["detectorArea", 
        RowBox[{"photonSphereArea", "[", 
         RowBox[{"universe", ",", "z"}], "]"}]], 
       FractionBox[
        RowBox[{"2", "\[Eta]0"}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", "\[Gamma]", "]"}], "\[Gamma]", 
           RowBox[{"(", 
            RowBox[{"1", "+", "z"}], ")"}]}], ")"}], 
         RowBox[{"2", "-", "\[Alpha]"}]]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            FractionBox["\[Theta]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                FractionBox["1", 
                 RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
                FractionBox[
                 SuperscriptBox["\[Theta]", "2"], "2"], "+", 
                FractionBox[
                 SuperscriptBox["\[Chi]", "2"], "2"], "-", 
                RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
              RowBox[{"5", "-", "\[Alpha]"}]]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"j", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"j", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "0", ",", "\[Chi]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Phi]", ",", "0", ",", "\[Pi]"}], "}"}]}], "]"}], "+", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            FractionBox["\[Theta]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                FractionBox["1", 
                 RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
                FractionBox[
                 SuperscriptBox["\[Theta]", "2"], "2"], "+", 
                FractionBox[
                 SuperscriptBox["\[Chi]", "2"], "2"], "-", 
                RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
              RowBox[{"5", "-", "\[Alpha]"}]]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"j", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"j", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "\[Chi]", ",", "\[Infinity]"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"\[Phi]", ",", "0", ",", "\[Pi]"}], "}"}]}], "]"}]}], 
        ")"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.589936126210228*^9, 3.589936343848271*^9}, {
   3.5899365248004932`*^9, 3.589936528423963*^9}, {3.58993662266119*^9, 
   3.589936723112678*^9}, {3.5900197488111343`*^9, 3.59001974973673*^9}, 
   3.590050095471758*^9, 3.590050486539094*^9, {3.590114285742614*^9, 
   3.590114286498996*^9}, {3.590114521530261*^9, 3.5901145344250193`*^9}, {
   3.59011520615725*^9, 3.590115206689993*^9}, {3.590149941571836*^9, 
   3.590149943201178*^9}, {3.590149986603722*^9, 3.590149989000428*^9}, {
   3.5901500700794363`*^9, 3.5901500895436783`*^9}, {3.5901501385787*^9, 
   3.590150168289069*^9}, {3.590150201255793*^9, 3.590150398428936*^9}, {
   3.5901504462695704`*^9, 3.590150494860758*^9}, {3.590150548359483*^9, 
   3.590150590355092*^9}, {3.590150649314307*^9, 3.590150653801833*^9}, {
   3.5901550508639717`*^9, 3.590155097406115*^9}, {3.590156130096141*^9, 
   3.590156132345707*^9}, 3.590156193276575*^9, {3.59015638237754*^9, 
   3.5901564310453663`*^9}, {3.5901565037737226`*^9, 3.59015654544372*^9}, {
   3.5901566143368607`*^9, 3.590156651142332*^9}, {3.590207713162766*^9, 
   3.590207737051004*^9}, {3.590317574136866*^9, 3.5903175972609167`*^9}, {
   3.590373496129187*^9, 3.5903734978963747`*^9}, {3.5903744495197573`*^9, 
   3.5903744553279057`*^9}, {3.590374487502187*^9, 3.59037449024564*^9}, {
   3.5903745212665243`*^9, 3.590374585319187*^9}, {3.590374638576312*^9, 
   3.590374689762074*^9}, {3.590374868885126*^9, 3.590374876528365*^9}, {
   3.5903749309309998`*^9, 3.590375003788867*^9}, {3.590376208418972*^9, 
   3.5903762223268757`*^9}, {3.590376436128688*^9, 3.590376438720146*^9}, {
   3.590376714901243*^9, 3.590376717275455*^9}, {3.590377340200777*^9, 
   3.590377359260088*^9}, {3.590657042830216*^9, 3.590657053196005*^9}, {
   3.5913255026474113`*^9, 3.5913255039982862`*^9}, {3.591859703943804*^9, 
   3.5918597128271503`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Duration", "Subsection",
 CellChangeTimes->{{3.590061518520788*^9, 3.590061520245708*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "duration", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"part", "\[Rule]", "0.99"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"duration", "[", 
    RowBox[{"universe_", ",", "burst", ",", "observer", ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "}"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "burstValues", ",", "observerValues", ",", "p\[Infinity]", ",", 
       "precision"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"burstValues", "=", 
       RowBox[{"{", 
        RowBox[{
        "\[Gamma]", ",", "\[Eta]0", ",", "r0", ",", "n", ",", "\[Omega]0", 
         ",", "\[Theta]0", ",", "k", ",", "\[Alpha]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"observerValues", "=", 
       RowBox[{"{", 
        RowBox[{"detectorArea", ",", "z", ",", "\[Chi]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"p\[Infinity]", "=", 
       RowBox[{"p", "[", 
        RowBox[{"universe", ",", "burstValues", ",", "observerValues", ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "\[Infinity]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pi", "[", 
        RowBox[{"\[Tau]_", "?", "NumberQ"}], "]"}], ":=", 
       RowBox[{"p", "[", 
        RowBox[{"universe", ",", "burstValues", ",", "observerValues", ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "\[Tau]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Tau]", "/.", 
       RowBox[{"FindRoot", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pi", "[", "\[Tau]", "]"}], "-", 
          RowBox[{
           RowBox[{"OptionValue", "[", "part", "]"}], "p\[Infinity]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Tau]", ",", 
           RowBox[{
            FractionBox["r0", 
             SuperscriptBox["\[Gamma]", "2"]], 
            RowBox[{"(", 
             RowBox[{"1.", "+", "z"}], ")"}]}]}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5903178050646343`*^9, 3.590317829891816*^9}, {
   3.590325149911132*^9, 3.5903252239269533`*^9}, {3.590325262389987*^9, 
   3.5903252825737123`*^9}, {3.59032532930599*^9, 3.590325335424121*^9}, {
   3.590325462525869*^9, 3.590325478694022*^9}, {3.590325518676382*^9, 
   3.590325519188765*^9}, {3.590361415786047*^9, 3.590361488999978*^9}, 
   3.590365687436039*^9, {3.590373135594748*^9, 3.590373148844438*^9}, 
   3.5903762546660767`*^9, {3.590376451567272*^9, 3.59037645210378*^9}, {
   3.59037673199723*^9, 3.590376732180722*^9}, 3.590377306536478*^9, {
   3.590377574242556*^9, 3.59037759171872*^9}, {3.5903779197300177`*^9, 
   3.5903779352168922`*^9}, {3.590657083045203*^9, 3.590657088028907*^9}, {
   3.590657227680119*^9, 3.590657311788023*^9}, {3.591859728415344*^9, 
   3.591859736190181*^9}, {3.592131053761468*^9, 3.592131054093618*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Stretching factor", "Subsection",
 CellChangeTimes->{{3.590042619518958*^9, 3.590042624004355*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"j\[Tau]", "[", 
    RowBox[{
    "burst", ",", "z_", ",", "\[Chi]_", ",", "\[Tau]_", ",", "\[Theta]_", ",",
      "\[Phi]_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Tau]", "\[Equal]", "\[Infinity]"}], ",", 
     "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
     FractionBox[
      SuperscriptBox["\[Tau]", "2"], 
      RowBox[{"1", "+", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"2", "\[Tau]"}], 
          RowBox[{"r0", " ", 
           RowBox[{"(", 
            RowBox[{"1", "+", "z"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "2"}], "+", 
             FractionBox["2", 
              RowBox[{"v", "[", "\[Gamma]", "]"}]], "+", 
             SuperscriptBox["\[Theta]", "2"], "+", 
             SuperscriptBox["\[Chi]", "2"], "-", 
             RowBox[{"2", " ", "\[Theta]", " ", "\[Chi]", " ", 
              RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}]}]], ")"}], 
        "n"]}]]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.590028599043091*^9, 3.5900287132878847`*^9}, {
  3.591866391902088*^9, 3.591866402347027*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"p\[Tau]", "[", 
    RowBox[{"universe_", ",", "burst", ",", "observer", ",", "\[Tau]_", ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "burstValues", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"burstValues", "=", 
       RowBox[{"{", 
        RowBox[{
        "\[Gamma]", ",", "\[Eta]0", ",", "r0", ",", "n", ",", "\[Omega]0", 
         ",", "\[Theta]0", ",", "k", ",", "\[Alpha]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       FractionBox["detectorArea", 
        RowBox[{"photonSphereArea", "[", 
         RowBox[{"universe", ",", "z"}], "]"}]], 
       FractionBox[
        RowBox[{"2", "\[Eta]0"}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", "\[Gamma]", "]"}], "\[Gamma]", 
           RowBox[{"(", 
            RowBox[{"1", "+", "z"}], ")"}]}], ")"}], 
         RowBox[{"2", "-", "\[Alpha]"}]]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            FractionBox["\[Theta]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                FractionBox["1", 
                 RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
                FractionBox[
                 SuperscriptBox["\[Theta]", "2"], "2"], "+", 
                FractionBox[
                 SuperscriptBox["\[Chi]", "2"], "2"], "-", 
                RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
              RowBox[{"5", "-", "\[Alpha]"}]]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}], 
            RowBox[{"j\[Tau]", "[", 
             RowBox[{
             "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]", ",", 
              "\[Theta]", ",", "\[Phi]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "0", ",", "\[Chi]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Phi]", ",", "0", ",", "\[Pi]"}], "}"}]}], "]"}], "+", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            FractionBox["\[Theta]", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                FractionBox["1", 
                 RowBox[{"v", "[", "\[Gamma]", "]"}]], "-", "1", "+", 
                FractionBox[
                 SuperscriptBox["\[Theta]", "2"], "2"], "+", 
                FractionBox[
                 SuperscriptBox["\[Chi]", "2"], "2"], "-", 
                RowBox[{"\[Theta]", " ", "\[Chi]", " ", 
                 RowBox[{"Cos", "[", "\[Phi]", "]"}]}]}], ")"}], 
              RowBox[{"5", "-", "\[Alpha]"}]]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]2", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}], "-", 
              RowBox[{"i", "[", 
               RowBox[{
               "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Omega]1", ",", 
                "\[Theta]", ",", "\[Phi]"}], "]"}]}], ")"}], 
            RowBox[{"j\[Tau]", "[", 
             RowBox[{
             "burstValues", ",", "z", ",", "\[Chi]", ",", "\[Tau]", ",", 
              "\[Theta]", ",", "\[Phi]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", "\[Chi]", ",", "\[Infinity]"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"\[Phi]", ",", "0", ",", "\[Pi]"}], "}"}]}], "]"}]}], 
        ")"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.590028703917103*^9, 3.5900287422583*^9}, {
  3.590370562028707*^9, 3.5903705817073174`*^9}, {3.5903735131271887`*^9, 
  3.5903735149247704`*^9}, {3.59037625873454*^9, 3.590376269432321*^9}, {
  3.59037645631063*^9, 3.590376459198489*^9}, {3.59037673697011*^9, 
  3.5903767402335653`*^9}, {3.590377252491696*^9, 3.590377271844862*^9}, {
  3.591859747140493*^9, 3.591859755062467*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "\[Kappa]", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Delta]", "\[Rule]", "0.01"}], ",", 
     RowBox[{"accurateQ", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Kappa]", "[", 
    RowBox[{"universe_", ",", "burst_", ",", "observer_", ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_", ",", "\[Omega]3_"}], "}"}], 
     ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "p12\[Infinity]", ",", "p23\[Infinity]", ",", "diff", ",", "diff\[Tau]",
        ",", "\[Delta]\[Tau]", ",", "\[Tau]middle", ",", "\[Tau]end", ",", 
       "\[Kappa]min", ",", "\[Kappa]max", ",", "minDifference", ",", 
       "maxDifference", ",", "diffDifference", ",", "precision", ",", 
       "accQ"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p12\[Infinity]", "=", 
       RowBox[{"p", "[", 
        RowBox[{"universe", ",", "burst", ",", "observer", ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "\[Infinity]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"p23\[Infinity]", "=", 
       RowBox[{"p", "[", 
        RowBox[{"universe", ",", "burst", ",", "observer", ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "\[Infinity]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Omega]2", ",", "\[Omega]3"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"diff", "[", 
        RowBox[{
         RowBox[{"\[Tau]_", "?", "NumberQ"}], ",", 
         RowBox[{"\[Kappa]_", "?", "NumberQ"}]}], "]"}], ":=", 
       RowBox[{
        FractionBox[
         RowBox[{"p", "[", 
          RowBox[{"universe", ",", "burst", ",", "observer", ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "\[Tau]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}], 
         "p12\[Infinity]"], "-", 
        FractionBox[
         RowBox[{"p", "[", 
          RowBox[{"universe", ",", "burst", ",", "observer", ",", 
           RowBox[{"{", 
            RowBox[{"0.", ",", 
             RowBox[{"\[Kappa]", " ", "\[Tau]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Omega]2", ",", "\[Omega]3"}], "}"}]}], "]"}], 
         "p23\[Infinity]"]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"diff\[Tau]", "[", 
        RowBox[{
         RowBox[{"\[Tau]_", "?", "NumberQ"}], ",", 
         RowBox[{"\[Kappa]_", "?", "NumberQ"}]}], "]"}], ":=", 
       RowBox[{
        FractionBox[
         RowBox[{"p\[Tau]", "[", 
          RowBox[{
          "universe", ",", "burst", ",", "observer", ",", "\[Tau]", ",", 
           RowBox[{"{", 
            RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}], 
         "p12\[Infinity]"], "-", 
        RowBox[{"\[Kappa]", " ", 
         FractionBox[
          RowBox[{"p\[Tau]", "[", 
           RowBox[{"universe", ",", "burst", ",", "observer", ",", 
            RowBox[{"\[Kappa]", " ", "\[Tau]"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Omega]2", ",", "\[Omega]3"}], "}"}]}], "]"}], 
          "p23\[Infinity]"]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"accQ", "=", 
       RowBox[{"OptionValue", "[", "accurateQ", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", "accQ", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Tau]end", "=", 
          RowBox[{"duration", "[", 
           RowBox[{"universe", ",", "burst", ",", "observer", ",", 
            RowBox[{"{", 
             RowBox[{"\[Omega]1", ",", "\[Omega]3"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Delta]\[Tau]", "=", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\[Delta]", "]"}], "\[Tau]end"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"maxDifference", "[", 
           RowBox[{"\[Kappa]_", "?", "NumberQ"}], "]"}], ":=", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"zero", ",", "derivativeZero"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"diff", "[", 
                RowBox[{"\[Delta]\[Tau]", ",", "\[Kappa]"}], "]"}], ">", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"diff", "[", 
                   RowBox[{"\[Tau]end", ",", "\[Kappa]"}], "]"}], ">", "0"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"derivativeZero", "=", 
                   RowBox[{"\[Tau]", "/.", 
                    RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{"diff\[Tau]", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\[Tau]", ",", "\[Delta]\[Tau]", ",", "\[Tau]end"}], 
                    "}"}]}], "]"}]}]}], ";"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"zero", "=", 
                   RowBox[{"\[Tau]", "/.", 
                    RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{"diff", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\[Tau]", ",", "\[Delta]\[Tau]", ",", "\[Tau]end"}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"derivativeZero", "=", 
                   RowBox[{"\[Tau]", "/.", 
                    RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{"diff\[Tau]", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "\[Delta]\[Tau]", ",", 
                    RowBox[{"zero", "-", "\[Delta]\[Tau]"}]}], "}"}]}], 
                    "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"derivativeZero", ",", 
                 RowBox[{"diff", "[", 
                  RowBox[{"derivativeZero", ",", "\[Kappa]"}], "]"}]}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"0.", ",", "0."}], "}"}]}], "\[IndentingNewLine]", 
             "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"minDifference", "[", 
           RowBox[{"\[Kappa]_", "?", "NumberQ"}], "]"}], ":=", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"zero", ",", "derivativeZero"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"diff", "[", 
                RowBox[{"\[Delta]\[Tau]", ",", "\[Kappa]"}], "]"}], "<", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"derivativeZero", "=", 
                RowBox[{"\[Tau]", "/.", 
                 RowBox[{"FindRoot", "[", 
                  RowBox[{
                   RowBox[{"diff\[Tau]", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    "\[Tau]", ",", "\[Delta]\[Tau]", ",", "\[Tau]end"}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"derivativeZero", ",", 
                 RowBox[{"diff", "[", 
                  RowBox[{"derivativeZero", ",", "\[Kappa]"}], "]"}]}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"diff", "[", 
                  RowBox[{"\[Tau]end", ",", "\[Kappa]"}], "]"}], "<", "0"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"zero", "=", 
                  RowBox[{"\[Tau]", "/.", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{"diff", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\[Tau]", ",", "\[Delta]\[Tau]", ",", "\[Tau]end"}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"derivativeZero", "=", 
                  RowBox[{"\[Tau]", "/.", 
                   RowBox[{"FindRoot", "[", 
                    RowBox[{
                    RowBox[{"diff\[Tau]", "[", 
                    RowBox[{"\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", 
                    RowBox[{"zero", "+", "\[Delta]\[Tau]"}], ",", 
                    "\[Tau]end"}], "}"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"derivativeZero", ",", 
                   RowBox[{"diff", "[", 
                    RowBox[{"derivativeZero", ",", "\[Kappa]"}], "]"}]}], 
                  "}"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "0."}], "}"}]}], "\[IndentingNewLine]", 
               "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Kappa]min", "=", 
          RowBox[{"\[Kappa]", "/.", 
           RowBox[{"FindRoot", "[", 
            RowBox[{
             RowBox[{"diff", "[", 
              RowBox[{"\[Delta]\[Tau]", ",", "\[Kappa]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Kappa]", ",", "1."}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Kappa]max", "=", 
          RowBox[{"\[Kappa]", "/.", 
           RowBox[{"FindRoot", "[", 
            RowBox[{
             RowBox[{"diff", "[", 
              RowBox[{"\[Tau]end", ",", "\[Kappa]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Kappa]", ",", "1."}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"diffDifference", "[", 
           RowBox[{"\[Kappa]_", "?", "NumberQ"}], "]"}], ":=", 
          RowBox[{
           RowBox[{
            RowBox[{"maxDifference", "[", "\[Kappa]", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"minDifference", "[", "\[Kappa]", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Kappa]", "/.", 
          RowBox[{"FindRoot", "[", 
           RowBox[{
            RowBox[{"diffDifference", "[", "\[Kappa]", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Kappa]", ",", "\[Kappa]min", ",", "\[Kappa]max"}], 
             "}"}]}], "]"}]}]}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Tau]middle", "=", 
          RowBox[{"duration", "[", 
           RowBox[{"universe", ",", "burst", ",", "observer", ",", 
            RowBox[{"{", 
             RowBox[{"\[Omega]1", ",", "\[Omega]3"}], "}"}], ",", 
            RowBox[{"part", "\[Rule]", "0.5"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Kappa]", "/.", 
          RowBox[{"FindRoot", "[", 
           RowBox[{
            RowBox[{"diff", "[", 
             RowBox[{"\[Tau]middle", ",", "\[Kappa]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Kappa]", ",", "1."}], "}"}]}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.5903265796208687`*^9, 3.590326833677573*^9}, {
   3.5903269327331257`*^9, 3.5903269503094893`*^9}, {3.590326987903431*^9, 
   3.5903271369707203`*^9}, {3.590327176239778*^9, 3.590327185314533*^9}, {
   3.5903272680607367`*^9, 3.590327271219748*^9}, {3.590327312586216*^9, 
   3.590327315351831*^9}, {3.590327388496572*^9, 3.590327480915551*^9}, {
   3.59032751419615*^9, 3.5903275248632917`*^9}, {3.590327561137848*^9, 
   3.590327564923519*^9}, {3.590327640238681*^9, 3.590327677067874*^9}, {
   3.590327813182415*^9, 3.590327828205284*^9}, {3.590328354366934*^9, 
   3.590328555755969*^9}, {3.5903286431336727`*^9, 3.590328659784225*^9}, 
   3.59032872295754*^9, {3.590329189043144*^9, 3.590329189722125*^9}, {
   3.5903650237753553`*^9, 3.5903651970818777`*^9}, {3.590365259406893*^9, 
   3.590365267195998*^9}, {3.5903654226609497`*^9, 3.590365456892521*^9}, {
   3.590365501664783*^9, 3.590365503984386*^9}, {3.590365568175743*^9, 
   3.590365573478949*^9}, {3.590365618227973*^9, 3.590365621461379*^9}, {
   3.5903657229232492`*^9, 3.59036572479393*^9}, {3.59036577981052*^9, 
   3.590365782180976*^9}, {3.5903659951005793`*^9, 3.590366003108227*^9}, {
   3.590366051467641*^9, 3.590366283475524*^9}, {3.590366406272266*^9, 
   3.5903664222486973`*^9}, {3.590366532280233*^9, 3.590366560568139*^9}, 
   3.590366612775997*^9, {3.5903666531368933`*^9, 3.5903666533696127`*^9}, {
   3.5903704326686993`*^9, 3.590370533346634*^9}, {3.5903705920432377`*^9, 
   3.590370715562079*^9}, {3.590370746441658*^9, 3.590371170661167*^9}, 
   3.590371248583733*^9, {3.590371412755732*^9, 3.590371549940089*^9}, {
   3.590371605026496*^9, 3.590371622782262*^9}, {3.590371724324032*^9, 
   3.590371738661891*^9}, {3.590372125774158*^9, 3.5903721789825907`*^9}, {
   3.590372659458366*^9, 3.590372660732067*^9}, {3.590372841198977*^9, 
   3.590372848830831*^9}, {3.590372949274189*^9, 3.590372954958375*^9}, {
   3.5903730718440933`*^9, 3.590373074450584*^9}, {3.590373162138679*^9, 
   3.590373164754616*^9}, {3.5903732574823713`*^9, 3.590373257613722*^9}, {
   3.590373332784211*^9, 3.5903733329269667`*^9}, {3.59037341674111*^9, 
   3.5903734194048243`*^9}, {3.590375379521632*^9, 3.590375382490905*^9}, {
   3.590375428952099*^9, 3.5903755736247063`*^9}, {3.590375724661763*^9, 
   3.590375782583375*^9}, {3.5903759191691513`*^9, 3.590375927059924*^9}, {
   3.5903760199509783`*^9, 3.590376024215468*^9}, {3.5903762774287863`*^9, 
   3.590376313791407*^9}, {3.590376464702487*^9, 3.590376489807502*^9}, {
   3.5903767460743427`*^9, 3.590376773731325*^9}, {3.590377131337274*^9, 
   3.59037721201258*^9}, {3.590377415812442*^9, 3.5903774737943296`*^9}, {
   3.590377527059918*^9, 3.590377533724476*^9}, {3.5903776145091867`*^9, 
   3.590377672534587*^9}, {3.5903778454072237`*^9, 3.590377882622674*^9}, {
   3.590381758973577*^9, 3.590381812886834*^9}, {3.5903873864196987`*^9, 
   3.590387458002425*^9}, {3.590387510659731*^9, 3.590387543611752*^9}, {
   3.59038758612471*^9, 3.590387621217507*^9}, {3.590388552680749*^9, 
   3.5903885528275633`*^9}, {3.59065748233827*^9, 3.590657557181745*^9}, {
   3.590657618614839*^9, 3.590657683718027*^9}, {3.590716042223925*^9, 
   3.59071604340497*^9}, {3.5907163929288683`*^9, 3.590716396686603*^9}, {
   3.590716711520685*^9, 3.590716712288282*^9}, {3.591859766023552*^9, 
   3.591859821493609*^9}, {3.59213105995527*^9, 3.592131060311899*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Total Energy", "Subsection",
 CellChangeTimes->{{3.591179569287243*^9, 3.5911795710461187`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"energy", "[", 
    RowBox[{"burst", ",", "\[Omega]1_"}], "]"}], ":=", 
   RowBox[{
    FractionBox[
     RowBox[{"16", 
      SuperscriptBox["\[Pi]", "3"]}], 
     RowBox[{"3", "n", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], "k"}], "-", "\[Alpha]", "-", "2"}], ")"}], 
      RowBox[{"Sin", "[", 
       FractionBox[
        RowBox[{"3", "\[Pi]"}], "n"], "]"}]}]], 
    SuperscriptBox["\[Gamma]", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], "k"}], "-", "\[Alpha]"}]], 
    RowBox[{"(", 
     RowBox[{"1", "-", 
      FractionBox["1", 
       RowBox[{"4", 
        SuperscriptBox["\[Gamma]", "2"]}]]}], ")"}], "\[Eta]0", " ", 
    SuperscriptBox["r0", "3"], 
    SuperscriptBox["\[Theta]0", "2"], 
    FractionBox[
     SuperscriptBox["\[Omega]0", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], "k"}], "-", "\[Alpha]"}]], 
     SuperscriptBox["\[Omega]1", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], "k"}], "-", "\[Alpha]", "-", "2"}]]]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.591267384750402*^9, 3.591267391974464*^9}, {
  3.591267431626403*^9, 3.5912674907454443`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Distribution", "Subsection",
 CellChangeTimes->{{3.592129665485837*^9, 3.592129667602376*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "maxz", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"minParticles", "\[Rule]", "10"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"maxz", "[", 
    RowBox[{
    "universe_", ",", "burst_", ",", "detectorArea_", ",", "\[Chi]_", ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "}"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"int", ",", "z1", ",", "z2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"int", "[", 
        RowBox[{"z_", "?", "NumberQ"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"universe", ",", "burst", ",", 
          RowBox[{"{", 
           RowBox[{"detectorArea", ",", "z", ",", "\[Chi]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "\[Infinity]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}], "-", 
        RowBox[{"OptionValue", "[", "minParticles", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"z1", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"int", "[", "z1", "]"}], "<", "0"}], ",", 
        RowBox[{"z1", "/=", "2."}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"z2", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"int", "[", "z2", "]"}], ">", "0"}], ",", 
        RowBox[{"z2", "*=", "2."}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"z", "/.", 
       RowBox[{"FindRoot", "[", 
        RowBox[{
         RowBox[{"int", "[", "z", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"z", ",", "z1", ",", "z2"}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5921304966002817`*^9, 3.592130552109898*^9}, {
  3.592130602992848*^9, 3.592130674463716*^9}, {3.5921308289039383`*^9, 
  3.592130919923584*^9}, {3.592130993209762*^9, 3.592131036607246*^9}, {
  3.592131068302374*^9, 3.592131114338842*^9}, {3.592187459284543*^9, 
  3.592187463651868*^9}, {3.5921894029246273`*^9, 3.592189416673624*^9}, {
  3.592189472174855*^9, 3.592189474840663*^9}, {3.592189512887924*^9, 
  3.5921895587398148`*^9}, {3.5921896539432096`*^9, 3.592189655743219*^9}, {
  3.5921897207067432`*^9, 3.592189792248406*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "max\[Chi]", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"minParticles", "\[Rule]", "10"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"max\[Chi]", "[", 
    RowBox[{"universe_", ",", "burst", ",", "detectorArea_", ",", "z_", ",", 
     RowBox[{"{", 
      RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "}"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"burstValues", ",", "int", ",", "\[Chi]0"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"burstValues", "=", 
       RowBox[{"{", 
        RowBox[{
        "\[Gamma]", ",", "\[Eta]0", ",", "r0", ",", "n", ",", "\[Omega]0", 
         ",", "\[Theta]0", ",", "k", ",", "\[Alpha]"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"int", "[", 
        RowBox[{"\[Chi]_", "?", "NumberQ"}], "]"}], ":=", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"universe", ",", "burstValues", ",", 
          RowBox[{"{", 
           RowBox[{"detectorArea", ",", "z", ",", "\[Chi]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.", ",", "\[Infinity]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Omega]1", ",", "\[Omega]2"}], "}"}]}], "]"}], "-", 
        RowBox[{"OptionValue", "[", "minParticles", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"int", "[", "0", "]"}], "<", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "0", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Chi]0", "=", 
          FractionBox["1", "\[Gamma]"]}], ";", "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"int", "[", "\[Chi]0", "]"}], ">", "0"}], ",", 
           RowBox[{
            RowBox[{"\[Chi]0", "*=", "2."}], ";"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Chi]", "/.", 
       RowBox[{"FindRoot", "[", 
        RowBox[{
         RowBox[{"int", "[", "\[Chi]", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Chi]", ",", "0", ",", "\[Chi]0"}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5921857052057743`*^9, 3.592185803579471*^9}, {
   3.59218608379284*^9, 3.592186084456647*^9}, {3.592186118768695*^9, 
   3.5921861369850273`*^9}, {3.592186279322113*^9, 3.592186283263797*^9}, {
   3.592186408819564*^9, 3.592186409833569*^9}, {3.592186514998681*^9, 
   3.5921865161561813`*^9}, {3.592186549874604*^9, 3.592186550490327*^9}, {
   3.592186845398295*^9, 3.592186871706634*^9}, {3.592186905081287*^9, 
   3.592186988885932*^9}, {3.592187058690855*^9, 3.5921870590983143`*^9}, 
   3.592189794467548*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Default Parameters", "Subsection",
 CellChangeTimes->{{3.592183416123457*^9, 3.592183427849206*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "defaultUniverse", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Hobs", "\[Rule]", "2.*^-18"}], ",", 
     RowBox[{"\[CapitalOmega]m", "\[Rule]", "0.317"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultUniverse", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"OptionValue", "[", "Hobs", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[CapitalOmega]m", "]"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.592183431358851*^9, 3.592183460249783*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "defaultBurst", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Gamma]", "\[Rule]", "100."}], ",", 
     RowBox[{"\[Eta]0", "\[Rule]", "1.*^45"}], ",", 
     RowBox[{"r0", "\[Rule]", "2.*^3"}], ",", 
     RowBox[{"n", "\[Rule]", "6"}], ",", 
     RowBox[{"\[Omega]0", "\[Rule]", "1."}], ",", 
     RowBox[{"\[Theta]0", "\[Rule]", "2.5*^-5"}], ",", 
     RowBox[{"k", "\[Rule]", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"\[Alpha]", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultBurst", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"OptionValue", "[", "\[Gamma]", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[Eta]0", "]"}], ",", 
     RowBox[{"OptionValue", "[", "r0", "]"}], ",", 
     RowBox[{"OptionValue", "[", "n", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[Omega]0", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[Theta]0", "]"}], ",", 
     RowBox[{"OptionValue", "[", "k", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[Alpha]", "]"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.592183471082691*^9, 3.592183527567327*^9}, {
   3.592185444675672*^9, 3.592185456046914*^9}, 3.592185591584156*^9, {
   3.5921856928131227`*^9, 3.592185694458848*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"defaultDetectorArea", "[", "]"}], ":=", "5.563*^-18"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.592183544436002*^9, 3.592183552917884*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "defaultObserver", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"detectorArea", "\[Rule]", 
      RowBox[{"defaultDetectorArea", "[", "]"}]}], ",", 
     RowBox[{"z", "\[Rule]", "1."}], ",", 
     RowBox[{"\[Chi]", "\[Rule]", "0."}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultObserver", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"OptionValue", "[", "detectorArea", "]"}], ",", 
     RowBox[{"OptionValue", "[", "z", "]"}], ",", 
     RowBox[{"OptionValue", "[", "\[Chi]", "]"}]}], "}"}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.5921835325126457`*^9, 3.592183542805168*^9}, {
  3.5921836390243387`*^9, 3.592183678941724*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
Evaluator->"Local",
WindowSize->{1221, 756},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 192, 4, 92, "Title"],
Cell[CellGroupData[{
Cell[639, 23, 92, 1, 80, "Section"],
Cell[CellGroupData[{
Cell[756, 28, 98, 1, 44, "Subsection"],
Cell[857, 31, 208, 5, 28, "Input"],
Cell[1068, 38, 305, 8, 28, "Input"],
Cell[1376, 48, 221, 6, 28, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1634, 59, 98, 1, 44, "Subsection"],
Cell[1735, 62, 317, 9, 70, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2089, 76, 101, 1, 44, "Subsection"],
Cell[2193, 79, 254, 6, 28, "Input"],
Cell[2450, 87, 1763, 46, 70, "Input"],
Cell[4216, 135, 1078, 19, 32, "Input"],
Cell[5297, 156, 498, 14, 54, "Input"],
Cell[5798, 172, 933, 29, 63, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6768, 206, 101, 1, 44, "Subsection"],
Cell[6872, 209, 2077, 54, 148, "Input"],
Cell[8952, 265, 2247, 61, 215, "Input"],
Cell[11202, 328, 6575, 141, 374, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17814, 474, 96, 1, 44, "Subsection"],
Cell[17913, 477, 3260, 75, 194, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21210, 557, 105, 1, 44, "Subsection"],
Cell[21318, 560, 1253, 32, 180, "Input"],
Cell[22574, 594, 4548, 107, 347, "Input"],
Cell[27125, 703, 15719, 332, 814, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42881, 1040, 102, 1, 44, "Subsection"],
Cell[42986, 1043, 1205, 39, 60, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44228, 1087, 100, 1, 44, "Subsection"],
Cell[44331, 1090, 2536, 61, 165, "Input"],
Cell[46870, 1153, 2933, 70, 265, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49840, 1228, 106, 1, 44, "Subsection"],
Cell[49949, 1231, 630, 18, 46, "Input"],
Cell[50582, 1251, 1394, 33, 63, "Input"],
Cell[51979, 1286, 188, 5, 28, "Input"],
Cell[52170, 1293, 807, 22, 46, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

